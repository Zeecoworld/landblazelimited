import{d as Z,s as G,b as J,v as c,e2 as Q,e3 as P,i as T,ac as X,dZ as ee,aD as se,c as e,du as te,e4 as re,w as f,e5 as D,a0 as n,N as y,e6 as i,dH as C,ah as H,K as L,k as ae}from"./ChUMkS6P.js";import{i as le}from"./A9nCysFq.js";import{I as U}from"./uNGU_bZw.js";import{L as j}from"./CWbzfonA.js";import{P as V}from"./C8eTOF1G.js";import"./CeHZR0Ph.js";import"./BgHkq_PJ.js";import"./BVv2S30c.js";import"./cuZZCMxh.js";import"./DldpU35S.js";import"./DzFfo68f.js";import"./CfeTNxv7.js";import"./Ck2GPDyH.js";const u=3,we=Z({name:"MenuSearchForm",props:{site:{type:Object,required:!0},isShowSearch:{type:Boolean,default:!1},isCatalogMode:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:W}){const{t:m}=G(),{$api:R}=J(),d=c(null),M=c(null),F=c(null),h=c(null),v=c(!1),k=c(!1),w=c(!1),l=c(new Q({posts:new P({results:[]}),pages:new P({results:[]}),products:new P({results:[]})})),b=T(()=>{var t,s;return((s=(t=l.value)==null?void 0:t.pages)==null?void 0:s.results)||[]}),p=T(()=>{var t;return((t=l.value.posts)==null?void 0:t.results)||[]}),g=T(()=>{var t,s;return((s=(t=l.value)==null?void 0:t.products)==null?void 0:s.results)||[]}),$=async()=>{var t;try{if(f(d.value)){A();return}k.value=!0,l.value=await R.get(new D({search:d.value,siteId:(t=o.site)==null?void 0:t.id,take:4,preHighlightTag:'<span class="kmb-site-search-selected-text">',postHighlightTag:"</span>"}))}catch(s){console.error("Error",s)}finally{k.value=!1}},_=()=>{try{W("close")}catch(t){console.log(t)}},A=()=>{try{l.value.pages.results=[],l.value.posts.results=[],l.value.products.results=[]}catch(t){console.log(t)}},I=t=>{t==null||t.stopPropagation();try{d.value=null,A()}catch(s){console.log(s)}},x=t=>{t==null||t.stopPropagation();try{v.value=!1,h.value=null,_(),I()}catch(s){console.log(s)}},z=async(t,s)=>{var r;t.stopPropagation();try{v.value=!0,w.value=!0;const a=await R.get(new D({search:d.value,siteId:(r=o.site)==null?void 0:r.id,take:100,contentTypes:[s],preHighlightTag:'<span class="kmb-site-search-selected-text">',postHighlightTag:"</span>"}));if(a)switch(s){case i.Page:l.value.pages.results=a.pages.results;break;case i.Post:l.value.posts.results=a.posts.results;break;case i.Product:l.value.products.results=a.products.results;break}h.value=s}catch(a){console.log(a)}finally{w.value=!1}};X(()=>{ee(()=>o.isShowSearch,t=>{if(t){const s=F.value;s&&s.focus()}})}),se(()=>{clearTimeout(M.value)});const S=(t,s)=>e("button",{onClick:r=>z(r,t)},[m("labels.all")," ",s>3&&e("span",null,[y("(+"),s-u,y(") "),e("i",{class:"kmb-site-icon-angle-right ml-1"},null)])]),B=t=>e("div",{class:"kmb-extras-search-form-result-item-list kmb-widget-row"},[t.map(s=>{const r=C({slug:s.slug,pageTemplateType:H.Product});return e(L,{to:r,onClick:a=>{x(a)},class:"kmb-extras-search-form-result-item-col md_w-1-3 w-full kmb-widget-col py-4 mb-2"},{default:()=>[e("div",{class:"kmb-extras-search-form-result-item kmb-extras-search-form-result-product-item kmb-md-widget-row kmb-flex-nowrap"},[e("div",{class:"kmb-md-widget-col"},[e(U,{value:s.mainImage,resize:{width:84,height:84},class:"kmb-extras-search-form-result-item-image kmb-widget-image-no-filter",style:"min-width: 84px;"},null)]),e("div",{class:"kmb-md-widget-col"},[e("p",{class:"kmb-extras-search-form-result-item-name font-semibold  mb-2",innerHTML:s.name},null),!f(s.description)&&e("div",{class:"kmb-extras-search-form-result-item-description truncate mb-3",innerHTML:s.description},null),!o.isCatalogMode&&e("div",{class:"kmb-widget-price-group flex"},[e(V,{site:o.site,value:s.price,class:ae({"kmb-widget-before-discount-price-amount":!!s.salePrice})},null),e(V,{site:o.site,value:s.salePrice,isEnabled:!!s.salePrice,class:"ml-3"},null)])])])]})})]),O=()=>{var t,s,r;if(!n(g.value))return e("div",{class:"kmb-extras-search-form-result-group-item kmb-extras-search-form-result-group-product-item"},[e("div",{class:"kmb-extras-search-form-result-group-item-head mb-2"},[e("div",{class:"kmb-widget-row items-center"},[e("div",{class:"w-1-2 kmb-widget-col"},[e("p",{class:"uppercase"},[m("labels.products")])]),((t=g.value)==null?void 0:t.length)>u&&e("div",{class:"w-1-2 kmb-widget-col text-right"},[S(i.Product,(s=l.value.products)==null?void 0:s.total)])])]),B((r=g.value)==null?void 0:r.slice(0,u))])},E=t=>e("div",{class:"kmb-extras-search-form-result-item-list kmb-widget-row"},[t.map(s=>{const r=C({slug:s.slug,pageTemplateType:H.Blog});return e(L,{to:r,onClick:a=>{x(a)},class:"kmb-extras-search-form-result-item-col md_w-1-3 w-full kmb-widget-col py-4 mb-2"},{default:()=>[e("div",{class:"kmb-extras-search-form-result-item kmb-extras-search-form-result-product-item kmb-md-widget-row kmb-flex-nowrap"},[e("div",{class:"kmb-md-widget-col"},[e(U,{value:s.coverImage,resize:{width:84,height:84},class:"kmb-extras-search-form-result-item-image kmb-widget-image-no-filter",style:"min-width: 84px;"},null)]),e("div",{class:"kmb-md-widget-col"},[e("p",{class:"kmb-extras-search-form-result-item-name font-semibold inline-block mb-2",innerHTML:s.name},null),!f(s.description)&&e("div",{class:"kmb-extras-search-form-result-item-description truncate mb-3",innerHTML:s.description},null)])])]})})]),Y=()=>{var t,s,r;if(!n(p.value))return e("div",{class:"kmb-extras-search-form-result-group-item kmb-extras-search-form-result-group-blog-post-item"},[e("div",{class:"kmb-extras-search-form-result-group-item-head mb-2"},[e("div",{class:"kmb-widget-row items-center"},[e("div",{class:"w-1-2 kmb-widget-col"},[e("p",{class:"uppercase"},[m("labels.blogPosts")])]),((t=p.value)==null?void 0:t.length)>u&&e("div",{class:"w-1-2 kmb-widget-col text-right"},[S(i.Post,(s=l.value.posts)==null?void 0:s.total)])])]),E((r=p.value)==null?void 0:r.slice(0,u))])},N=t=>e("div",{class:"kmb-extras-search-form-result-item-list kmb-widget-row"},[t.map(s=>{const r=C({slug:s.slug,pageTemplateType:H.Page});return e(L,{to:r,onClick:a=>{x(a)},class:"kmb-extras-search-form-result-item-col w-full kmb-widget-col py-4 mb-2"},{default:()=>[e("div",{class:"kmb-extras-search-form-result-item kmb-extras-search-form-result-page-item"},[!f(s.name)&&e("p",{class:"kmb-extras-search-form-result-item-name font-semibold inline-block mb-2",innerHTML:s.name},null),!n(s.widgetContents)&&e("div",{class:"kmb-extras-search-form-result-item-description"},[s.widgetContents.filter(a=>!le(a)).map(a=>e("p",{innerHTML:a},null))])])]})})]),q=()=>{var t,s,r;if(!n(b.value))return e("div",{class:"kmb-extras-search-form-result-group-item kmb-extras-search-form-result-group-page-item"},[e("div",{class:"kmb-extras-search-form-result-group-item-head mb-2"},[e("div",{class:"kmb-widget-row items-center"},[e("div",{class:"w-1-2 kmb-widget-col"},[e("p",{class:"uppercase"},[m("labels.content")])]),((t=b.value)==null?void 0:t.length)>u&&e("div",{class:"w-1-2 kmb-widget-col text-right"},[S(i.Page,(s=l.value.pages)==null?void 0:s.total)])])]),N((r=b.value)==null?void 0:r.slice(0,u))])},K=()=>{if(h.value==i.Product)return B(g.value);if(h.value==i.Post)return E(p.value);if(h.value==i.Page)return N(b.value)};return{search:d,debounce:M,search_field:F,onHide:x,onSeach:$,onHandleClose:_,onClearSearch:I,renderSarchFormResult:()=>k.value?e(j,{class:"kmb-simple-loading kmb-blue-loading kmb-extras-search-loading",isLoading:k.value},null):n(b.value)&&n(p.value)&&n(g.value)?e("div",{class:"kmb-extras-search-form-empty-result text-center flex items-center justify-center",style:"min-height: 180px;"},[e("p",{class:"kmb-extras-search-form-empty-result-text"},[m("labels.resultsFor",0),y(" “"),d.value,y("”")])]):v.value?w.value?e(j,{class:"kmb-simple-loading kmb-blue-loading kmb-extras-search-loading",isLoading:w.value},null):e("div",{class:"kmb-extras-search-form-result-group-all-list"},[e("div",{class:"mb-6"},[e("button",{onClick:()=>{v.value=!1,h.value=null}},[e("i",{class:"kmb-site-icon-angle-left mr-2"},null),m("buttons.backToAllSearch")])]),K()]):e("div",{class:"kmb-extras-search-form-result-group-list"},[O(),Y(),q()])}},render(){return e("div",{class:"kmb-extras-search-form"},[e("div",{class:"kmb-extras-search-form-group flex items-center justify-between"},[e("div",{class:"kmb-extras-search-form-field-group relative flex items-center"},[e("i",{class:"kmb-site-icon-search mr-2"},null),te(e("input",{"onUpdate:modelValue":o=>this.search=o,ref:"search_field",class:"kmb-extras-search-form-field w-full",placeholder:this.$t("labels.typeWhatYouWant"),onInput:async()=>{clearTimeout(this.debounce),this.debounce=setTimeout(async()=>{await this.onSeach()},600)}},null),[[re,this.search]])]),e("div",{class:"kmb-extras-search-form-btn-group flex items-center"},[this.search&&e("button",{class:"kmb-extras-search-form-btn kmb-extras-search-form-clear-btn",onClick:o=>this.onClearSearch(o)},[this.$t("labels.clear")]),e("button",{class:"kmb-extras-search-form-btn kmb-extras-search-form-close-btn ml-5",onClick:o=>{this.onHandleClose(),this.onClearSearch(o)}},[e("i",{class:"kmb-site-icon-close"},null)])])]),!f(this.search)&&e("div",{class:"kmb-extras-search-form-result-group"},[this.renderSarchFormResult()])])}});export{we as default};
