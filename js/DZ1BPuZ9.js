import{d as F,s as L,v as f,c as a,w as b,z as x,aP as G}from"./ChUMkS6P.js";import{D as K}from"./D9Hbs_0D.js";import{C as p}from"./Dc9JWRGJ.js";import{L as V}from"./CWbzfonA.js";import{a as _,S as q}from"./BJMjv6C5.js";import"./A9nCysFq.js";import"./CeHZR0Ph.js";function u(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!x(r)}const U=F({name:"ProductFilter",props:{query:{type:Object,required:!0},collection:{type:Object,required:!0},productGroupOptions:{type:Object,required:!0},isEnabledFilter:{type:Boolean,default:!1},activeKey:{type:[Number,String]},uiType:{type:String,default:"default"}},emits:["filter","setActiveKey"],setup(r,{emit:d}){const{t:h}=L(),w=f(!1),n=f([]),c=f(r.query.productGroupsDic||{}),O=()=>{try{b(c.value)||Object.values(c.value).forEach(t=>{t!=null&&t.length&&(n.value=[...n.value,...t])})}catch(t){console.log(t)}},S=t=>{try{const e=[];return t.options.forEach(l=>{const i=e.find(s=>s.label===l.label);if(i)i.count+=l.count;else{const s=JSON.parse(JSON.stringify(l));e.push(s)}}),e}catch(e){console.log(e)}},y=(t,e,l)=>{try{let i=c.value[t.label];if(!i&&l&&(c.value[t.label]=[],i=c.value[t.label]),i)if(l)i.push(e.label);else{const s=i.indexOf(e.label);s>-1&&i.splice(s,1)}b(i)&&(delete c.value[t.label],G.removeByKey(c.value,t.label)),r.query.productGroupsDic=c.value}catch(i){console.log(i)}},v=(t,e,l)=>{try{y(t,e,l),d("filter")}catch(i){console.log(i)}},C=t=>{var e;try{if(!t||b(t==null?void 0:t.options))return;(e=t==null?void 0:t.options)==null||e.forEach(l=>{y(t,l,!1)}),n.value=n.value.filter(l=>!t.options.some(i=>i.label===l)),d("filter")}catch(l){console.log(l)}},g=t=>{var e;if(!(b(n.value)||!((e=t.options)!=null&&e.find(l=>n.value.includes(l.label)))))return a("button",{class:"kmb-filter-clear-btn",onClick:()=>C(t)},[h("labels.clear")])},k=t=>a("span",{class:"kmb-filter-label-el block"},[t==null?void 0:t.label]),j=()=>{let t;return r.uiType=="default"?a("div",{class:"kmb-product-filters kmb-default-product-filters"},[a("div",{class:"kmb-widget-row"},[r.productGroupOptions.productGroups.map((e,l)=>{if(!b(e==null?void 0:e.options))return a("div",{class:"lg_w-1-3 md_w-1-2 w-full kmb-collection-filter-widget-item-col kmb-widget-col",key:l},[a("div",{class:"kmb-collection-filter-widget-default-item"},[a("p",{class:"kmb-collection-filter-widget-default-item-name kmb-widget-title-h4 mb-3",innerHTML:e.label},null),a("div",{class:"kmb-filter-group-list kmb-md-widget-row"},[e.options.map(i=>{let s;return a("div",{class:"kmb-filter-item mb-2 kmb-md-widget-col"},[a(p,{modelValue:n.value,"onUpdate:modelValue":o=>n.value=o,label:i.label,labelClassName:"kmb-widget-text-body2",onChange:o=>v(e,i,o)},u(s=k(i))?s:{default:()=>[s]})])})])])])})])]):a(q,{class:"kmb-product-filters kmb-accordion-product-filters",activeKey:r.activeKey,onChange:e=>d("setActiveKey",e)},u(t=r.productGroupOptions.productGroups.map((e,l)=>{if(!b(e==null?void 0:e.options)){const i=e.label?`${e.label.replace(/\s+/g,"_")}_${e.type}`:l;return a(_,{key:l,index:l,itemKey:i,"data-filter-group-key":e.key,"data-filter-group-type":e.type,class:"kmb-page-sidebar-widget-accordion-item kmb-collection-sidebar-widget-accordion-item"},{header:()=>a("div",{class:"flex justify-between items-center"},[a(K,{value:e.label,tag:"h3",class:"kmb-widget-sub-title kmb-collection-sidebar-widget-title"},null),g(e)]),default:()=>a("div",{class:"kmb-filter-group-list"},[S(e).map(s=>{let o;return a("div",{class:"kmb-filter-item mb-1"},[a(p,{modelValue:n.value,"onUpdate:modelValue":m=>n.value=m,label:s.label,labelClassName:"kmb-widget-text-body2",onChange:m=>v(e,s,m)},u(o=k(s))?o:{default:()=>[o]})])})])})}}))?t:{default:()=>[t]})};return O(),{isLoading:w,filterValues:n,renderFilterGroupList:j}},render(){var r,d;if(this.isEnabledFilter){if(this.isLoading)return a(V,{class:"kmb-simple-loading kmb-blue-loading",isLoading:this.isLoading},null);if((d=(r=this.productGroupOptions)==null?void 0:r.productGroups)!=null&&d.length)return a("div",{class:"kmb-collection-products-filters-widget"},[this.renderFilterGroupList()])}}});export{U as default};
